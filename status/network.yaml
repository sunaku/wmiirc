status:
  network:
    params:
      ifconfig: /sbin/ifconfig
      iwconfig: /sbin/iwconfig
      interface: lo

    script: |
      def ifconfig
        `#{@ifconfig} #{@interface} 2>&1`
      end

      def iwconfig
        `#{@iwconfig} #{@interface} 2>&1`
      end

      def wireless?
        iwconfig.match(/IEEE 802\.11/s)
      end

    label: |
      ifconfig = self.ifconfig

      alive = ifconfig !~ /\A\S+ error/
      ip_addr = ifconfig[/inet (?:addr:)?([\d.]+)/, 1]

      if alive and ip_addr
        color = 'normal'
        rx_bytes, tx_bytes = ifconfig.scan(/\((\d+(?:\.\d+)? \w+)\)/)
        stats = [ip_addr, "\u2798", rx_bytes, "\u279A", tx_bytes]
      else
        color = 'error'
        stats = []
      end

      iwconfig = self.iwconfig
      if wireless?
        if match = iwconfig.match(/ESSID:"([^"]+)"/)
          stats.unshift match[1]
          stats.unshift "\u223f"
        else
          color = 'error'
        end
      end

      [color, @interface, stats]

    control:
      action:
        network_details: 'dialog wireless? ? [iwconfig, ifconfig].join("\n") : ifconfig'

      mouse_action:
        left_click: network_details
